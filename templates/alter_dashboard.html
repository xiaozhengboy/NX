<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>风机叶片检测告警系统</title>
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/bootstrap-icons.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<!-- 导航栏 -->
<div class="header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <h1><img src="{{ url_for('static',filename='hdlogo.png') }}"></img> 风机叶片检测告警系统</h1>

        </div>
    </div>
</div>

<div class="container">
    <!-- 筛选面板 -->
    <div class="filter-panel">
        <div class="filter-row">
            <!-- 修改风机号筛选器，添加搜索功能 -->
            <div class="filter-group">
                <div class="filter-label">风机号筛选
                    <span class="mt-1">
                        <button class="btn btn-sm btn-outline-primary me-1" id="refreshCamerasBtn">
                            <i class="bi bi-arrow-clockwise"></i> 刷新
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" id="toggleCameraSearchBtn">
                            <i class="bi bi-search"></i> 搜索
                        </button>
                    </span>
                </div>
                <div class="position-relative">
                    <select class="form-select form-select-sm" id="cameraFilter">
                        <option value="">全部风机</option>
                    </select>
                    <div class="input-group mt-1" style="display: none;" id="cameraSearchContainer">
                        <input type="text" class="form-control form-control-sm"
                               id="cameraSearchInput"
                               placeholder="输入风机号搜索...">
                        <button class="btn btn-sm btn-outline-secondary"
                                type="button"
                                id="cameraSearchToggle">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="filter-group">
                <div class="filter-label">缺陷名称

                </div>
                <select class="form-select form-select-sm" id="defectFilter">
                    <option value="">全部缺陷</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">置信度 ≥</div>
                <input type="number" class="form-control form-control-sm" id="confidenceMin"
                       placeholder="0.00" min="0" max="1" step="0.01">
            </div>
            <div class="filter-group">
                <div class="filter-label">开始时间</div>
                <input type="datetime-local" class="form-control form-control-sm" id="startTime">
            </div>
            <div class="filter-group">
                <div class="filter-label">结束时间</div>
                <input type="datetime-local" class="form-control form-control-sm" id="endTime">
            </div>
            <div class="filter-group">
                <button class="btn btn-load w-100" id="loadBtn">
                    <i class="bi bi-funnel"></i> 筛选
                </button>
            </div>
        </div>
    </div>

    <!-- 视图切换 -->
    <div class="view-toggle d-flex justify-content-between align-items-center">
        <div class="btn-group" role="group">
            <button type="button" class="btn view-btn active" id="gridViewBtn">
                <i class="bi bi-grid-3x3-gap"></i> 宫格视图
            </button>
            <button type="button" class="btn view-btn" id="tableViewBtn">
                <i class="bi bi-table"></i> 表格视图
            </button>
        </div>

        <div class="pagination-info text-center text-muted mb-3">
            <span class="text-muted" id="resultCount">正在加载告警数据...</span>
            <span class="mx-2">|</span>
            每页显示
            <select class="form-select form-select-sm d-inline w-auto mx-1" id="pageSizeSelect">
                <option value="9">9</option>
                <option value="21" selected>21</option>
                <option value="51">51</option>
                <option value="99">99</option>
            </select>
            条
        </div>
    </div>

    <!-- 告警展示区域 -->
    <div id="alertsContainer">
        <!-- 宫格视图 -->
        <div id="gridView" class="grid-container"></div>

        <!-- 表格视图 -->
        <div id="tableView" class="table-container">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th width="80">图片</th>
                    <th width="120">风机编号</th>
                    <th width="150">检测时间</th>
                    <th width="100">缺陷数量</th>
                    <th>缺陷详情</th>
                    <th width="120">操作</th>
                </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
    <!-- 分页控件 -->
    <div class="pagination-container" id="paginationContainer">
        <nav aria-label="告警分页">
            <ul class="pagination justify-content-center" id="paginationList">
                <li class="page-item disabled" id="prevPageBtn">
                    <a class="page-link" href="#" aria-label="上一页">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
                <!-- 页码将通过JavaScript动态生成 -->
                <li class="page-item disabled" id="nextPageBtn">
                    <a class="page-link" href="#" aria-label="下一页">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>

<!-- 空状态 -->
<div id="emptyState" class="empty-state">
    <div class="empty-icon">
        <i class="bi bi-check-circle"></i>
    </div>
    <h4 class="empty-text">暂无告警数据</h4>
    <p class="text-muted">当前筛选条件下没有找到告警记录</p>
    <button class="btn btn-outline-primary mt-3" onclick="resetFilters()">
        <i class="bi bi-arrow-clockwise"></i> 重置筛选条件
    </button>
</div>

<!-- 详情模态框 -->
<div class="modal fade detail-modal" id="detailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">告警详情</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- 左侧：图片 -->
                <div class="detail-image-container">
                    <img id="detailImage" src="" alt="告警图片" onclick="openFullscreenViewer(this.src)">
                </div>

                <!-- 右侧：详细信息 -->
                <div class="detail-info-container">
                    <!-- 基本信息 -->
                    <div class="detail-info-section">
                        <h6>告警基本信息</h6>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">告警ID</span>
                                <span class="info-value" id="detailAlertId"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">风机名称</span>
                                <span class="info-value" id="detailCameraName"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">检测时间</span>
                                <span class="info-value" id="detailDetectionTime"></span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">缺陷数量</span>
                                <span class="info-value" id="detailDefectCount"></span>
                            </div>
                        </div>
                    </div>

                    <!-- 缺陷列表 -->
                    <div class="detail-info-section">
                        <h6>缺陷详情</h6>
                        <div class="defect-list" id="defectList"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> 关闭
                </button>
                <button type="button" class="btn btn-primary" onclick="downloadAlertData()">
                    <i class="bi bi-download"></i> 导出数据
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 全屏图片查看器 -->
<div class="fullscreen-viewer" id="fullscreenViewer">
    <div class="viewer-controls">
        <button class="viewer-btn" onclick="zoomOut()" title="缩小">
            <i class="bi bi-zoom-out"></i>
        </button>
        <button class="viewer-btn" onclick="resetZoom()" title="重置">
            <i class="bi bi-arrow-counterclockwise"></i>
        </button>
        <button class="viewer-btn" onclick="zoomIn()" title="放大">
            <i class="bi bi-zoom-in"></i>
        </button>
        <button class="viewer-btn" onclick="closeFullscreenViewer()" title="关闭">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>

    <div class="zoom-indicator" id="zoomIndicator">
        100%
    </div>

    <img id="fullscreenImage" src="" alt="全屏图片">

    <div class="viewer-hint">
        鼠标滚轮缩放 • 按住鼠标拖拽 • ESC键关闭
    </div>
</div>

<!-- 刷新按钮 -->
<button class="refresh-fab" id="refreshBtn" title="刷新数据">
    <i class="bi bi-arrow-clockwise"></i>
</button>


<!-- 更新时间显示 -->
<div class="update-time" id="updateTime">
    搜索模式：
    <span class="align-items-center">
        <button class="btn  btn-primary btn-sm me-2" id="realtimeModeBtn">
            <i class="bi bi-lightning-charge"></i> 实时模式
        </button>
        <button class="btn btn-outline-secondary btn-sm" id="historyModeBtn">
            <i class="bi bi-search"></i> 历史搜索
        </button>
    </span> <br/>
    连接状态：<span id="connectionStatus" class="badge bg-success">已连接</span> <br/>
    当前时间：<span id="currentTime" class="me-3">XXXX年XX月XX日</span> <br/>
    最后更新：<span id="lastUpdateTime">正在加载...</span>
</div>

<!-- 依赖库 -->
<script src="{{ url_for('static', filename='js/jquery-3.6.0.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/moment.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/zh-cn.min.js') }}"></script>

<!-- 自定义JavaScript -->
<script src="{{ url_for('static', filename='js/alter_dashboard.js') }}"></script>
</body>
</html>